---
title: "ETC5521 Assignment 1"
subtitle: "Beach Volleyball Stats"
team: [emu]
author:
  - [Justin Thomas]
  - [Mayunk Bharadwaj]
date: "`r Sys.Date()`"
output: 
  html_document
---

[This assignment is for ETC5521 Assignment 1 by Team `r rmarkdown::metadata$team` comprising of `r knitr::combine_words(rmarkdown::metadata$author)`.]{style="color:#006DAE;"}

```{r}
library(tidyverse)
library(readr)
library(plotly)
library(kableExtra)
```


# Introduction and motivation

[FILL] Give the bigger picture of the data, and inspire the reader to learn more about the problem by reading your analysis. 

# Data description

```{r data-read-in, include=FALSE}

vb_matches <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-05-19/vb_matches.csv', guess_max = 76000)
```

**Questions we will be looking to answer:**

**Primary Question**

What does a winning beach volleyball team's profile look like for both male and female teams?

**Secondary Questions**

Which countries have the most winning players?
What is the average age of a winning team and how does it compare with a losing team?
What is the average height of a winning team and how does it compare with a losing team?

## Explanation of data being used
This data set provides beach volleyball statistics for men's and women's matches at two major tournaments, the Fédération Internationale de Volleyball (FIVB) Beach Volleyball World Championships and the Association of Volleyball Professionals (AVP) tour. The matches are played with teams of 2. In this data set, tournament information, player information, player performance statistics and match results are recorded. The data provided ranges from September 2000 to August 2019 and it has been collected by the data recorded at the tournaments. 

The original data source created by Adam Vagner had initial data recorded from September 2000 to July 2017, however it has been periodically updated with the most recent update coming in May 2020. This can be found at https://github.com/BigTimeStats/beach-volleyball.

The structure of the data set is:
Rows: 76756
Columns: 65
Data types: Character, Numeric, Data and Difftime  

There are 65 variables in this data set:

  1)"circuit"                 2) "tournament"             3) "country"              
  4) "year"                   5) "date"                   6) "gender"               
  7) "match_num"              8) "w_player1"              9) "w_p1_birthdate"       
 10) "w_p1_age"              11) "w_p1_hgt"              12) "w_p1_country"         
 13) "w_player2"             14) "w_p2_birthdate"        15) "w_p2_age"             
 16) "w_p2_hgt"              17) "w_p2_country"          18) "w_rank"               
 19) "l_player1"             20) "l_p1_birthdate"        21) "l_p1_age"             
 22) "l_p1_hgt"              23) "l_p1_country"          24) "l_player2"            
 25) "l_p2_birthdate"        26) "l_p2_age"              27) "l_p2_hgt"             
 28) "l_p2_country"          29) "l_rank"                30) "score"                
 31) "duration"              32) "bracket"               33) "round"                
 34) "w_p1_tot_attacks"      35) "w_p1_tot_kills"        36) "w_p1_tot_errors"      
 37) "w_p1_tot_hitpct"       38) "w_p1_tot_aces"         39) "w_p1_tot_serve_errors"
 40) "w_p1_tot_blocks"       41) "w_p1_tot_digs"         42) "w_p2_tot_attacks"     
 43) "w_p2_tot_kills"        44) "w_p2_tot_errors"       45) "w_p2_tot_hitpct"      
 46) "w_p2_tot_aces"         47) "w_p2_tot_serve_errors" 48) "w_p2_tot_blocks"      
 49) "w_p2_tot_digs"         50) "l_p1_tot_attacks"      51) "l_p1_tot_kills"       
 52) "l_p1_tot_errors"       53) "l_p1_tot_hitpct"       54) "l_p1_tot_aces"        
 55) "l_p1_tot_serve_errors" 56) "l_p1_tot_blocks"       57) "l_p1_tot_digs"        
 58) "l_p2_tot_attacks"      59) "l_p2_tot_kills"        60) "l_p2_tot_errors"      
 61) "l_p2_tot_hitpct"       62) "l_p2_tot_aces"         63) "l_p2_tot_serve_errors"
 64) "l_p2_tot_blocks"       65) "l_p2_tot_digs"

## Data Cleaning

Our data was already in tidy format, so we did not have much cleaning to do. However in order to conduct our analysis, we have tidied the data set by removing variables that are not pertinent to answer our questions. 

```{r tidy-data, include=FALSE}
vb_matches <- vb_matches %>% select(-duration:-l_p2_tot_digs) %>% select(c(-tournament, -match_num, -w_rank, -l_rank))
```

The methods we have used to tidy our data is as follows:

- We deselected some variables from appearing in the data set and overwrote the original data set with the new tidied data set.

The reason for why we did not include variables such as match duration, or individual player performance statistics was because it did not fit with answering the questions we have laid out. Additionally, majority of the data for these variables were unknown, so it would not have been useful in our analysis.

## Description of variables in data set as organised in tidy form 

Variable       | Description
---------------|------------
circuit	       |Either AVP (USA) or FIVB (International)
country	       |Country where tournament played
year	         |Year of tournament
date	         |Date of match
gender	       |Gender of team
w_player1	     |Winner player 1 Name
w_p1_birthdate |Winner player 1 birth date
w_p1_age       |Winner player 1 age
w_p1_hgt	     |Winner player 1 height in inches
w_p1_country	 |Winner player country
w_player2	     |Winner player 2 name
w_p2_birthdate |Winner player 2 birth date
w_p2_age	     |Winner player 2 age
w_p2_hgt	     |Winner player 2 height in inches
w_p2_country	 |Winner player 2 country
l_player1	     |Losing player 1 name
l_p1_birthdate |Losing player 1 birth date
l_p1_age	     |Losing player 1 age
l_p1_hgt	     |Losing player 1 height in inches
l_p1_country	 |Losing player 1 country
l_player2	     |Losing player 2 name
l_p2_birthdate |Losing player 2 birth date
l_p2_age	     |Losing player 2 age
l_p2_hgt	     |Losing player 2 height in inches
l_p2_country	 |Losing player 2 country
score	         |Match score separated by a dash and matches separated by a comma, eg 21 points to 12 points is 21-12

## Data sources

The original data is sourced from:
Vagner, A. (2020, July 20). *BigTimeStats/beach-volleyball*. Retrieved August 22, 2020, from https://github.com/BigTimeStats/beach-volleyball

To load the data set, we had to use a GitHub repository that had the data set. The name of this repository is "Tidy Tuesday". The data set was sourced from this repository:
Mock, J. (2020, May 19). *rfordatasciene/tidytuesday*. Retrieved August 22, 2020, from 
https://github.com/rfordatascience/tidytuesday/blob/master/data/2020/2020-05-19/readme.md


# Analysis and findings

[FILL] Should include at least one plot or numerical summary for each of your questions, that helps the reader arrive at an answer. You should also write paragraphs describing the methods, summaries and findings. 

## Which countries have the most winning players?

For both the AVP and FIVB tournaments, a team consists of 2 players. Each player in the team either comes from the same country or they can come from different countries. Thus, in this section, our analysis focuses on finding the countries that had the most number of winning teams. This will help us find the countries that had the most winning players. 

```{r arrange-desc, include=FALSE}
country <- vb_matches %>% distinct(w_player1, w_p1_country, w_player2, w_p2_country) %>%                 group_by(w_p1_country, w_p2_country) %>% 
                tally() %>% drop_na() %>% arrange(desc(n))
```

```{r rename-variables, include=FALSE}
country <- country %>% rename(`Player 1 country` = w_p1_country,
                     `Player 2 country` = w_p2_country,
                     `Number of teams` = n)
```

In order to find our answer to this question, we first did some data wrangling to get the data set up for analysis. Then we followed the steps outlined below:

- Firstly, find the distinct players in the variables w_p1_country and w_p2_country. This is to ensure we don't get multiple rows of the same team with the same combination of player 1 and player 2. 
- After getting distinct players, we grouped the players by their respective countries.
- Following this, we use the tally() function to count up the total number of teams by countries and dropped any rows that had no values in them. 
- This gave us a list of all the participating countries with a total count of winning teams per country.
- We rearranged the data to show the total count in descending order and we also renamed the variables to make it more meaningful.
- Lastly, we saved this as a new data set called "country" to be used later on.

```{r plot-teams, echo=FALSE, fig.cap="Top 20 countries with the most winning teams"}
p1 <- ggplot(country %>% head(20), aes(`Number of teams`, reorder(`Player 1 country`, +`Number of teams`))) +
  geom_bar(stat = "identity", fill = "steelblue") +
  xlab("Number of teams") +
  ylab("Country") +
  ggtitle("Top 20 countries with the most winning teams") +
  theme(panel.grid.major = element_blank()) +
  theme(plot.background = element_rect(fill = "grey93"))

ggplotly(p1, tooltip = "x")
```


Figure \@ref(fig:plot-teams) shows the top 20 countries with the most number of winning teams. We can see that the United States was the most dominating country with a total of 4200 winning teams. This means that 8400 players came from the United States and won. In distant second place, Brazil had 258 winning teams, and so 516 Brazilian players won matches. In a close third place, Germany triumphed with 200 winning teams comprising of 500 players. The remaining teams ranged from having 166 winning teams to 45 winning teams.

The clear winner here is United States and we can conclude that majority of the winning players in the AVP and FIVB tournaments hail from the United States.


We decided to dig further into United States. Although there were 4200 teams where both players in each team came from the United States, there were instances were 1 player came from the United States and another player came from a different country. This following section takes a look at the different countries that partnered with the United States.

```{r USA, include=FALSE}
USA <- country %>% filter(`Player 1 country` == "United States" | `Player 2 country` == "United States") 
```

In order to find the different countries that partnered with the United States, we followed the steps outlined below:

- First, we filtered the rows from the "country" data set so that values from "Player 1 country" variable are "United States" or values from "Player 2 country" variable are "United States". 

This gave us a list of all the different country combinations where either player 1 or player 2 came from the United States and the other non-USA player's country.


```{r USA-combos, echo=FALSE}
USA %>% head(20) %>% kable %>% kable_styling(bootstrap_options = c("hover", "striped"))
```


Figure \@ref(tab:USA-combos) shows 20 different country combinations, which is only a subset of the different countries that partnered with the United States. In total there were 66 different combinations. 

Apart from both players coming from the United States, 44 different teams had player 1 come from the United States and player 2 come from Brazil. 34 teams had player 1 come from Poland and player 2 come from the United States. 

From looking at the rest of the table, we can see just how popular the United States is as a competing country in volleyball tournaments. It not only registers in tournaments where both players come from the United States, but it also registers where only 1 player in the team comes from the United States and partners with a player from a different country.

# References
